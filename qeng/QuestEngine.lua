local v0={};local v1=string.char;local v2=string.byte;local v3=string.sub;local v4=bit32 or bit ;local v5=v4.bxor;local v6=table.concat;local v7=table.insert;local function v8(v32,v33) local v34={};for v73=1, #v32 do v7(v34,v1(v5(v2(v3(v32,v73,v73 + 1 )),v2(v3(v33,1 + (v73% #v33) ,1 + (v73% #v33) + 1 )))%256 ));end return v6(v34);end local v9,v10=...;local v11=v10.QuestScriptTokens;local v12,v13=v10.QuestLog,v10.QuestStatus;local v14=v10.QuestEngineLogger:NewLogger(v8("\242\204\201\32","\126\177\163\187\69\134\219\167"),v10.LogLevel.info);local v15={[v8("\39\200\44\204\242\42\217\35\202\242\48","\156\67\173\74\165")]={[v8("\36\182\91\23\177\35\82\49\165\90","\38\84\215\41\118\220\70")]={},[v8("\83\25\44\22\247\68\31\45\28\237","\158\48\118\66\114")]={},[v8("\168\44\21\53\120\181\244\162\42\4\37","\155\203\68\112\86\19\197")]={},[v8("\73\223\60\249\67\108\236\238\67\206","\152\38\189\86\156\32\24\133")]={}}};v10.QuestEngine=v15;local v17=v15.definitions.parameters;local v18=v15.definitions.conditions;local v19=v15.definitions.checkpoints;local v20=v15.definitions.objectives;v15.AddDefinition=function(v35,v36,v37,v38) local v39=0;local v40;while true do if (v39==0) then v40=v15.definitions;if ((3291>1667) and  not v40[v36]) then local v97=0;while true do if (v97==0) then v14:Fatal("Failed to create definition: '%s' is not a recognized definition type",tostring(v36));return;end end end v39=1;end if (v39==2) then v40[v36][v37]=v38;break;end if (v39==1) then if ((type(v37)~=v8("\239\67\181\79\242\80","\38\156\55\199")) or (v37=="") or (873==2034)) then local v98=0;while true do if (v98==0) then v14:Fatal("Failed to create %s: '%s' is not a valid definition name",v36,tostring(v37));return;end end end if (v40[v36][v37] or (2816<11)) then local v99=0;while true do if (v99==0) then v14:Fatal("Failed to create %s: '%s' is already a registered %s",v36,v37,v36);return;end end end v39=2;end end end;v15.Validate=function(v41,v42) if ((3699<4706) and ((type(v42.questId)~=v8("\187\105\110\33\29\115","\35\200\29\28\72\115\20\154")) or (v42.questId==""))) then return false,v8("\8\170\212\204\153\5\48\89\182\194\159\159\41\37\12\182\195\218\137","\84\121\223\177\191\237\76");end if ((2646>=876) and ((type(v42.name)~=v8("\168\66\219\169\52\87","\161\219\54\169\192\90\48\80")) or (v42.name==""))) then return false,v8("\88\87\5\54\93\2\14\36\68\71\64\44\90\2\18\32\88\87\9\55\76\70","\69\41\34\96");end if ((614<=3184) and (type(v42.objectives)~=v8("\168\194\213\6\7","\75\220\163\183\106\98"))) then return false,v8("\19\175\142\36\205\66\181\137\61\220\1\174\130\33\220\17\250\134\34\202\22\250\137\50\153\6\191\141\62\215\7\190","\185\98\218\235\87");end for v74,v75 in ipairs(v42.objectives) do local v76=0;local v77;while true do if (v76==1) then v77=v20[v75.name];if ( not v77 or (3877==3575)) then return false,v10:Enquote(v75.name)   .. v8("\246\224\57\139\22\161\39\135\183\169\60\202\20\167\55\135\185\235\32\206\27\186\58\209\179","\167\214\137\74\171\120\206\83") ;end v76=2;end if (v76==3) then if ((1465<=4301) and (type(v75.conditions)~=v8("\19\239\167\194\2","\174\103\142\197"))) then return false,v10:Enquote(v75.name)   .. v8("\22\37\74\43\49\30\240\87\62\90\120\38\81\246\82\33\75\49\42\80\235\22\44\90\62\44\80\253\82","\152\54\72\63\88\69\62") ;end for v100,v101 in pairs(v75.conditions) do local v102=0;local v103;while true do if (0==v102) then v103=v77.conditions and v77.conditions[v100] ;if ((1704>1425) and  not v103) then return false,v10:Enquote(v100)   .. v8("\148\205\253\28\218\203\250\28\213\132\248\93\216\205\234\28\215\203\224\88\221\208\231\83\218\132\232\83\198\132\225\94\222\193\237\72\221\210\235\28","\60\180\164\142")   .. v10:Enquote(v77.name) ;end break;end end end break;end if (v76==0) then if ((3126==3126) and ((type(v75.id)~=v8("\216\40\53\239\208\173","\202\171\92\71\134\190")) or (v75.id==""))) then return false,v8("\38\195\38\141\42\213\37\158\44\129\37\140\105\200\63\200\59\196\61\157\32\211\41\140","\232\73\161\76");end if ((type(v75.name)~=v8("\168\205\80\84\16\188","\126\219\185\34\61")) or (v75.name=="") or (2187>=4954)) then return false,v8("\3\204\84\119\125\99\250\241\9\142\80\115\115\114\179\238\31\142\76\119\111\98\250\245\9\202","\135\108\174\62\18\30\23\147");end v76=1;end if (v76==2) then if ((707>632) and ((type(v75.goal)~=v8("\133\229\63\95\253\181","\199\235\144\82\61\152")) or (v75.goal<=(619 -(529 + 90))))) then return false,v10:Enquote(v75.name)   .. v8("\71\25\187\33\2\21\173\34\17\19\249\38\18\5\173\107\15\23\175\46\71\23\249\44\8\23\181\107\89\86\233","\75\103\118\217") ;end if ((type(v75.progress)~=v8("\201\65\125\22\188\12","\126\167\52\16\116\217")) or (v75.progress<(1817 -(1703 + 114))) or (546>=2684)) then return false,v10:Enquote(v75.name)   .. v8("\136\33\34\138\177\26\232\193\56\37\192\185\12\239\220\110\40\129\162\28\188\216\60\47\135\166\28\239\219\110\126\221\244\73","\156\168\78\64\224\212\121") ;end v76=3;end end end return true;end;local function v23(v43,v44) local v45=v19[v11[v43]];if ((v45 and v45.Evaluate) or (687==4234)) then return v45:Evaluate(v44);else local v78=0;while true do if (0==v78) then v14:Warn(v8("\123\86\0\42\44\253\29\81\80\17\105\98\254\82\81\77\69\36\46\254\1\81\80\2\105\40\255\82\81\80\19\40\43\228\22\22","\114\56\62\101\73\71\141"),v43);return false;end end end end v15.EvaluateStart=function(v46,v47) local v48=0;local v49;while true do if (v48==0) then if ( not v47 or (3330<1429)) then return false;end if ((1147>=335) and  not v47.start) then return true;end v48=1;end if (v48==1) then v49=v19[v11.CMD_START]:Evaluate(v47.start);return v49;end end end;v15.EvaluateComplete=function(v50,v51) return  not v51.complete or v23(v8("\155\196\255\251\155\198\246\244\148\204\239\225","\164\216\137\187"),v51.complete) ;end;v15.EvaluateRecommendations=function(v52,v53) return  not v53.recommended or v23(v8("\241\203\21\141\148\219\40","\107\178\134\81\210\198\158"),v53.recommended) ;end;v15.EvaluateRequirements=function(v54,v55) local v56=0;local v57;while true do if (1==v56) then v57=v19[v11.CMD_REQ]:Evaluate(v55.required);return v57;end if (v56==0) then if ((3435>2097) and  not v55) then return false;end if ( not v55.required or (3770>=4041)) then return true;end v56=1;end end end;v15.StartTracking=function(v58,v59) local v60=0;local v61;local v62;local v63;while true do if (v60==0) then v61,v62=v15:Validate(v59);if ( not v61 or (3791<=1611)) then local v104=0;while true do if (v104==0) then v14:Error(v8("\27\15\140\200\165\44\78\150\212\171\59\5\194\215\191\61\29\150\156\234\125\29","\202\88\110\226\166"),v62);return false;end end end v60=1;end if (v60==2) then if ((1125<=2076) and v63) then local v105=0;while true do if (0==v105) then v10.AppEvents:Publish(v8("\242\26\135\228\222\247\29\131\244\193\202\1\133\196\222\194\29\150\242\206","\170\163\111\226\151"),v59);v14:Trace(v8("\34\36\179\42\90\50\45\81\36\160\57\77\60\32\31\55\242\41\91\50\58\5\106\242\125\93","\73\113\80\210\88\46\87"),v59.name);break;end end else v14:Trace(v8("\160\32\193\82\232\131\38\200\17\243\136\58\200\1\167\128\62\200\82\230\141\62\200\19\227\152\108\207\23\238\143\43\141\6\245\128\47\198\23\227\193\42\194\0\189\193\105\222","\135\225\76\173\114"),v59.name);end return v63;end if (1==v60) then v63=false;for v82,v83 in pairs(v59.objectives) do local v84=0;while true do if (v84==0) then v20[v83.name].active=v20[v83.name].active or {} ;if ( not v20[v83.name].active[v83.id] or (4578<=2008)) then local v112=0;while true do if (v112==0) then v20[v83.name].active[v83.id]=v83;v63=true;break;end end end break;end end end v60=2;end end end;v15.StopTracking=function(v64,v65) local v66=0;local v67;while true do if (v66==0) then v67=false;for v85,v86 in pairs(v65.objectives) do if ((v20[v86.name].active and v20[v86.name].active[v86.id]) or (743>=4399)) then local v107=0;while true do if (v107==0) then v20[v86.name].active[v86.id]=nil;v67=true;break;end end end end v66=1;end if (v66==1) then if ((1155<1673) and v67) then local v106=0;while true do if (v106==0) then v10.AppEvents:Publish(v8("\43\248\189\163\184\137\181\27\238\179\185\162\186\148\14\226\168\160\169\185","\199\122\141\216\208\204\221"),v65);v14:Trace(v8("\158\201\31\224\104\243\169\157\4\226\121\245\166\212\30\247\56\231\184\216\3\228\34\182\232\206","\150\205\189\112\144\24"),v65.name);break;end end else v14:Trace(v8("\11\139\255\67\6\130\20\19\49\141\169\73\23\200\6\21\55\129\255\78\1\129\31\23\101\144\173\77\7\131\20\20\101\130\176\94\94\200\84\3","\112\69\228\223\44\100\232\113"),v65.name);end return v67;end end end;v15.Init=function(v68) local v69=0;while true do if (v69==1) then v10.AppEvents:Subscribe(v8("\189\16\90\85\240\101\229\128\0\75\67\224","\128\236\101\63\38\132\33"),function(v87) v15:StopTracking(v87);end);v10.AppEvents:Subscribe(v8("\157\188\20\87\162\207\206\184\168\35\65\165\238\219","\175\204\201\113\36\214\139"),function() local v88=0;while true do if (v88==0) then for v109,v110 in pairs(v20) do v110.active={};end v14:Trace(v8("\118\217\48\207\16\99\205\33\221\54\66\223\48\200\68\10\140\6\200\11\87\220\48\216\68\83\222\52\223\15\78\194\50\156\5\75\192\117\211\6\77\201\54\200\13\81\201\38","\100\39\172\85\188"));break;end end end);break;end if (v69==0) then for v89,v90 in pairs(v20) do v90:Init();end v14:Debug(v8("\229\10\2\192\162\89\136\211\22\9\214\246\112\137\213\27\2\215\246\83\173\149","\230\180\127\103\179\214\28"));v69=1;end end end;v15.StartTrackingQuestLog=function(v70) local v71=0;local v72;while true do if (0==v71) then v72=v12:FindByQuery(function(v91) return v91.status==v13.Active ;end);for v92,v93 in pairs(v72) do local v94=0;local v95;local v96;while true do if (v94==0) then v95,v96=pcall(v15.StartTracking,v15,v93);if ( not v95 or (2324<=578)) then v14:Error('Failed to start quest tracking for quest \"%s\": %s',v93.name,v96);end break;end end end break;end end end;